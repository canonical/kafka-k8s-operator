# Charm Statuses

The charm follows [standard Juju applications statuses](https://juju.is/docs/olm/status-values#heading--application-status). Here you can find the expected end-users reaction on different statuses:

## Kafka

| Juju Status     | Message                                                                    | Expectations                                                                                                                                                                                        | Actions                                                                                                                                                                                  |
|-----------------|----------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Active**      |                                                                            | Normal charm operations                                                                                                                                                                             | No actions required                                                                                                                                                                      |
| **Active**      | manual partition reassignment may be needed to utilize new storage volumes | Existing data is not automatically rebalanced when new storage is attached. New storage will be used for newly created topics and/or partitions                                                     | Inspect the storage utilization and based on the need, use the bash utility script `/snap/charmed-kafka/current/opt/kafka/bin/kafka-reassign-partitions.sh` for manual data rebalancing. |
| **Active**      | potential data loss due to storage removal without replication             | Some partition/topics are not replicated on multiple storages, therefore potentially leading to data loss                                                                                           | Add new storage, increase replication of topics/partitions and/or rebalance data across multiple storages/brokers                                                                        |
| **Active**      | sysctl params cannot be set. Is the machine running on a container?        | Some of the sysctl settings required by Kafka could not be set, therefore affective Kafka performance and correct settings. This can also be due to the charm being deployed on the wrong substrate | Remove the deployment and make sure that the selected charm is correct given the juju cloud substrate                                                                                    |                                        
| **Blocked**     | service not running                                                        | The charm failed to start the snap daemon processes                                                                                                                                                 | Check the kafka logs for insights on the issue                                                                                                                                           |
| **Blocked**     | missing required zookeeper relation                                        | Kafka charm has not been connected to any ZooKeeper cluster                                                                                                                                         | Relate to a ZooKeeper charm                                                                                                                                                              |
| **Blocked**     | unit not connected to zookeeper                                            | Although the relation is present, the unit has failed to connect to ZooKeeper                                                                                                                       | Make sure that Kafka and ZooKeeper can connect and exchange data. When using encryption, make sure that certificates/ca are correctly setup.                                             |
| **Blocked**     | tls must be enabled on both kafka and zookeeper                            | Encryption (and relation with tls-certificates operators) must be either enabled or disabled on both Kafka and ZooKeeper                                                                            | Make sure that both Kafka and ZooKeeper either both use or neither of them use encryption.                                                                                               |
| **Waiting**     | zookeeper credentials not created yet                                      | Credentials are being created on ZooKeeper, and Kafka is waiting to receive them to connect to ZooKeeper                                                                                            |                                                                                                                                                                                          |
| **Waiting**     | internal broker credentials not yet added                                  | Intra-broker credentials being created for allowing communication and syncing among brokers belonging to the Kafka clusters.                                                                        |                                                                                                                                                                                          |
| **Waiting**     | unit waiting for signed certificates                                       | Unit has requested a CSR request via the `certificates` relation and it is waiting to received the signed certificate                                                                               |                                                                                                                                                                                          |
| **Maintenance** |                                                                            | Charm is performing the internal maintenance (e.g. cluster re-configuration, upgrade, ...)                                                                                                          | No actions required                                                                                                                                                                      |
| **Error**       | any                                                                        | An unhanded internal error happened                                                                                                                                                                 | Read the message hint. Execute `juju resolve <error_unit/0>` after addressing the root of the error state                                                                                |
| **Terminated**  | any                                                                        | The unit is gone and will be cleaned by Juju soon                                                                                                                                                   | No actions possible                                                                                                                                                                      |
| **Unknown**     | any                                                                        | Juju doesn't know the charm app/unit status. Possible reason: K8s charm termination in progress.                                                                                                    | Manual investigation required if status is permanent                                                                                                                                     |


## ZooKeeper

| Juju Status     | Message                                                  | Expectations                                                                                                                    | Actions                                                                                                                                                                                                   |
|-----------------|----------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Active**      |                                                          | Normal charm operations                                                                                                         | No actions required                                                                                                                                                                                       |
| **Blocked**     | zookeeper service not running                            | The charm failed to start the snap daemon processes                                                                             | Check the ZooKeeper logs for insights on the issue                                                                                                                                                        |
| **Blocked**     | zookeeper service is unreachable or not serving requests | The ZooKeeper service is either down or not exposed through the correct port                                                    | Check the ZooKeeper logs for the impacted units and insights on underlying issue                                                                                                                          |                                                                                                                         |
| **Waiting**     | waiting for leader to create internal user credentials   | The ZooKeeper cluster is being initialized and the leader is setting up credentials                                             |                                                                                                                                                                                                           |
| **Waiting**     | other units starting first                               | ZooKeeper units are being started and added to the quorum in order                                                              |                                                                                                                                                                                                           |
| **Waiting**     | unit waiting for signed certificates                     | Unit has requested a CSR request via the `certificates` relation and it is waiting to received the signed certificate           |                                                                                                                                                                                                           |
| **Maintenance** | not all units registered IP                              | The units are being registered to the quorum                                                                                    |                                                                                                                                                                                                           |                                                                                                                                          | |
| **Maintenance** | zookeeper container not ready                            | The workload container with ZooKeeper is being setup                                                                            |                                                                                                                                                                                                           |
| **Maintenance** | cluster not stable - not all units related               | Some ZooKeeper units are not connected, reducing cluster ability to perform elections and/or provide high-availability          | Make sure the units can reach each other and communicate                                                                                                                                                  |
| **Maintenance** | cluster not stable - quorum is stale                     | The cluster does not have an active quorum, preventing the cluster from running elections                                       | Do not perform any extra-ordinary operation. Wait for the units to connect and form a quorum. If the problem persists, please check the ZooKeeper logs on all units for further insights.                 |
| **Maintenance** | cluster not stable - not all units added to quorum       | Some ZooKeeper units are not part of the quorum, reducing cluster ability to perform elections and/or provide high-availability | Do not perform any extra-ordinary operation. Wait for the units to connect and form a quorum. If some units keep being not connected, please check the ZooKeeper logs of such units for further insights. |
| **Maintenance** | provider not ready - not all units using same encryption | Units use different settings for encryption, therefore preventing correct cluster operations.                                   | This situation can transiently occur when new protocols / certificates are being setup. If the message persist, please check the ZooKeeper logs for further insights.                                     |
| **Maintenance** | provider not ready - switching quorum encryption         | Encryption is being enabled / disabled.                                                                                         | This situation can transiently occur when encryption are being setup. If the message persist, please check the ZooKeeper logs for further insights.                                                       |
| **Maintenance** | provider not ready - portUnification not yet disabled    | Specifies that the client port should accept SSL connections (using the same configuration as the secure client port).          |                                                                                                                                                                                                           |
| **Error**       | any                                                      | An unhanded internal error happened                                                                                             | Read the message hint. Execute `juju resolve <error_unit/0>` after addressing the root of the error state                                                                                                 |
| **Terminated**  | any                                                      | The unit is gone and will be cleaned by Juju soon                                                                               | No actions possible                                                                                                                                                                                       |
| **Unknown**     | any                                                      | Juju doesn't know the charm app/unit status. Possible reason: K8s charm termination in progress.                                | Manual investigation required if status is permanent                                                                                                                                                      |

