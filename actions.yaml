# Copyright 2023 Canonical Ltd.
# See LICENSE file for licensing details.
pre-upgrade-check:
  description: Run necessary pre-upgrade checks before executing a charm upgrade.

resume-upgrade:
  description: Resume a rolling upgrade after asserting successful upgrade of a new revision.

set-tls-private-key:
  description: Sets the private key identifying the target unit, which will be used for certificate signing requests (CSR).
    When updated, certificates will be reissued to the unit.
    Run for each unit separately. Requires a valid relation to an application providing the `certificates` relation interface.
  params:
    internal-key:
      type: string
      description: The content of private key for internal communications with clients.
        Content will be auto-generated if this option is not specified.
        Can be raw-string, or base64 encoded.

get-listeners:
  description: Get all active listeners and their port allocations

rebalance:
  description: Trigger a rebalance of cluster partitions based on configured goals
  params:
    mode:
      type: string
      description: The operation to issue to the balancer. This action must be called on the leader unit.
        'full' - runs a full rebalance of all partitions across the whole cluster
        'add' - evenly distributes replicas to new and available brokers
        'remove' - moves under-replicated partition replicas assigned to decommissioned brokers, to available ones
      enum: [full, add, remove]
    dryrun:
      description: Only generate the partition rebalance proposals and estimated result, without executing
      type: boolean
      default: true
    brokerid:
      description: Broker ID newly added to the cluster or to be removed. The broker ID is the unit number, e.g. kafka/0 is broker 0.
      type: integer
      minimum: 0
  required: [mode]

pre-refresh-check:
  description: Check if charm is ready to refresh
  additionalProperties: false

force-refresh-start:
  description: |
    Potential of data loss and downtime

    Force refresh of first unit

    Must run with at least one of the parameters `=false`
  params:
    check-compatibility:
      type: boolean
      default: true
      description: | 
        Potential of data loss and downtime

        If `false`, force refresh if new version of Kafka and/or charm is not compatible with previous version
    run-pre-refresh-checks:
      type: boolean
      default: true
      description: |
        Potential of data loss and downtime

        If `false`, force refresh if app is unhealthy or not ready to refresh (and unit status shows "Pre-refresh check failed")
    check-workload-container:
      type: boolean
      default: true
      description: | 
        Potential of data loss and downtime during and after refresh

        If `false`, allow refresh to Kafka container version that has not been validated to work with the charm revision
  additionalProperties: false

resume-refresh:
  description: |
    Refresh next unit(s) (after you have manually verified that refreshed units are healthy)

    If the `pause-after-unit-refresh` config is set to `all`, this action will refresh the next unit.

    If `pause-after-unit-refresh` is set to `first`, this action will refresh all remaining units.
    Exception: if automatic health checks fail after a unit has refreshed, the refresh will pause.

    If `pause-after-unit-refresh` is set to `none`, this action will have no effect unless it is called with `check-health-of-refreshed-units` as `false`.
  params:
    check-health-of-refreshed-units:
      type: boolean
      default: true
      description: |
        Potential of data loss and downtime

        If `false`, force refresh (of next unit) if 1 or more refreshed units are unhealthy

        Warning: if first unit to refresh is unhealthy, consider running `force-refresh-start` action on that unit instead of using this parameter.
        If first unit to refresh is unhealthy because compatibility checks, pre-refresh checks, or workload container checks are failing, this parameter is more destructive than the `force-refresh-start` action.
  additionalProperties: false